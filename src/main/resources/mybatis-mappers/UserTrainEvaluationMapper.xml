<?xml version="1.0" encoding="UTF-8" ?><!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.zw.admin.server.dao.UserTrainEvaluationDao">

    <sql id="where">
        <where>
            <if test="params.id != null and params.id != ''">
                and id = #{params.id}
            </if>
            <if test="params.evaluation_id != null and params.evaluation_id != ''">
                and evaluation_id = #{params.evaluationId}
            </if>
            <if test="params.user_id != null and params.user_id != ''">
                and user_id = #{params.userId}
            </if>
            <if test="params.machine_id != null and params.machine_id != ''">
                and machine_id = #{params.machineId}
            </if>
            <if test="params.type != null and params.type != ''">
                and type = #{params.type}
            </if>
            <if test="params.data != null and params.data != ''">
                and data = #{params.data}
            </if>
        </where>
    </sql>

    <select id="count" resultType="int">
    select count(1) from user_train_evaluation t
        <include refid="where"/>
    </select>

    <select id="list" resultType="UserTrainEvaluation">
        select * from user_train_evaluation t
        <include refid="where"/>
        ${params.orderBy} limit #{offset}, #{limit}
    </select>

    <update id="update">
    update user_train_evaluation t
        <set>
            <if test="evaluation_id != null">
                evaluation_id = #{evaluationId},
            </if>
            <if test="user_id != null">
                user_id = #{userId},
            </if>
            <if test="machine_id != null">
                machine_id = #{machineId},
            </if>
            <if test="type != null">
                type = #{type},
            </if>
            <if test="data != null">
                data = #{data},
            </if>
        </set>
        where t.id = #{id}
    </update>

    <!--根据机构场所查询-->
    <sql id="selectByMachineAndUserIds">
        m.machine_type != 'Mouse'
        <if test="machineIds !=null and machineIds.size >0">
            and e.machine_id in
            <foreach collection="machineIds" item="item" separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="userIds !=null and userIds.size >0">
            and e.user_id in
            <foreach collection="userIds" item="item" separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="onlineId !=null and onlineId !=null">
            and e.user_id = #{onlineId}
        </if>
        <if test="userId !=null and userId !=null">
            and e.user_id = #{userId}
        </if>
    </sql>

    <select id="selectTrainEvaluationPage" resultType="com.zw.admin.server.model.UserTrainEvaluationBo">
        SELECT
            u. NAME user_name,
            e.id,
            e.user_id,
            e.evaluation_id,
            e.machine_id,
            m.machine_type,
            e.type,
            -- e.`data`,
            e.update_time
        FROM
            user_train_evaluation e
        JOIN machine_info m ON e.machine_id = m.sn
        JOIN `user` u ON e.user_id = u.id
        <where>
            <include refid="selectByMachineAndUserIds"/>
        </where>
        order by e.update_time desc
    </select>

    <select id="selectTrainEvaluationBoList" resultType="com.zw.admin.server.model.UserTrainEvaluationBo">
        SELECT
        u. NAME user_name,
        e.id,
        e.user_id,
        e.evaluation_id,
        e.machine_id,
        m.machine_type,
        e.type,
        e.data,
        e.update_time
        FROM
        user_train_evaluation e
        JOIN machine_info m ON e.machine_id = m.sn
        JOIN `user` u ON e.user_id = u.id
        <where>
            <if test="id !=null">
               and e.id = #{id}
            </if>
            <if test="userId !=null and userId !=''">
               and e.user_id = #{userId}
            </if>
            <if test="machineType !=null and machineType !=''">
               and m.machine_type = #{machineType}
            </if>
            <if test="updateTime !=null">
                and e.update_time &lt;= #{updateTime}
            </if>
            <if test="type !=null">
                and e.type = #{type}
            </if>
        </where>
        order by e.update_time asc
    </select>
</mapper>