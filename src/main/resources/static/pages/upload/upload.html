<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" type="text/css" media="screen" href="../../layui/css/layui.css">
<link rel="stylesheet" type="text/css" media="screen" href="../../css/bootstrap.min.css">
</head>
<body>

<div>
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
            <div>
                <header style="height: 100%">
                    <div align="left">
	                    <table style="width: 100%">
	                   		<tr>
	                   			<td>
		                   			<form class="form-inline" onsubmit="return false">
										<div class="form-group">
											id：
											<input id="id" type="text" class="form-control" placeholder="id">
											<button id="searchBt" class="layui-btn layui-btn-sm"><i class="layui-icon">&#xe615;</i>搜索</button>
										</div>
									</form>
	                   			</td>
	                   			<td align="right">
	                   				<button class="layui-btn layui-btn-sm" onclick="location.href='addEquipment.html'">
                                      <i class="layui-icon">&#xe608;</i> 添加
                                    </button>
	                   			</td>
	                   		</tr> 
	                    </table>
					</div>
                </header>
                
                <div>
                    <div class="widget-body no-padding">
                        <table id="dt-table" class="table table-striped table-bordered table-hover" style="width:100%">
                            <thead>
                                <tr>
                                </tr>                       
                                <tr>
									<th>id</th>
									<th>名字</th>
									<th>版本号</th>
									<th>操作</th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>



















<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
	<form class="form-horizontal" onsubmit="return false" id="form">
		<fieldset>
	
	
		</fieldset>
	</form>
	<button type="button" class="layui-btn" id="upload">
	  <i class="layui-icon">&#xe67c;</i>上传zip
	</button>
	<div id="versionDiv">
    </div>
</div>

<div id="uploadPatchForm"  class="roundRect">
    <div  id="uploadLoadingDiv">
	<div class="layui-progress" lay-showpercent="true" lay-filter="demo" >
	    <div class="layui-progress-bar layui-bg-red" lay-percent="0%"></div>
        </div>
    </div>
   
</div>


	<script type="text/javascript" src="../../js/libs/jquery-2.1.1.min.js"></script>
	<script type="text/javascript" src="../../js/jq.js"></script>
	<script type="text/javascript" src="../../layui/layui.js"></script>
	<script type="text/javascript" src="../../js/plugin/bootstrapvalidator/bootstrapValidator.min.js"></script>
	<script type="text/javascript">
	var pro = window.location.protocol;
    var host = window.location.host;
    var domain = pro + "//" + host;
    
    
    
  //创建监听函数
	 var xhrOnProgress=function(fun) {
		xhrOnProgress.onprogress = fun; //绑定监听
		 //使用闭包实现监听绑
		return function() {
			//通过$.ajaxSettings.xhr();获得XMLHttpRequest对象
			var xhr = $.ajaxSettings.xhr();
			 //判断监听函数是否为函数
			  if (typeof xhrOnProgress.onprogress !== 'function')
			       return xhr;
			   //如果有监听函数并且xhr对象支持绑定时就把监听函数绑定上去
			    if (xhrOnProgress.onprogress && xhr.upload) {
			          xhr.upload.onprogress = xhrOnProgress.onprogress;
			    }
			    return xhr;
		 }
	 }
    
    layui.use(['upload','element','layer'], function(){
	  	  var layer = layui.layer;
	  	  var upload = layui.upload;
	  	  var element = layui.element;
	  	  
		upload.render({
		    elem: '#upload' //缁戝畾鍏冪礌
		    ,accept: 'file' //鍏佽涓婁紶鐨勬枃浠剁被鍨�
		    ,exts:'zip'
		    ,url: '/files' //涓婁紶鎺ュ彛
	    	,xhr:xhrOnProgress
	    	,progress:function(value){//上传进度回调 value进度值
	    	    element.progress('demo', value+'%')//设置页面进度条
	    	}
			,before: function(input){
				//返回的参数item，即为当前的input DOM对象
					console.log('文件上传中');
				}
		    ,done: function(res, index, upload){
		    	if(res.code==0){
		    		var a = "<span>"+res.name+" 的当前版本号: "+res.version+"</span>";
	                 $("#versionDiv").html(a);
		    		layer.msg("上传成功");
		    		element.progress('demo', 0+'%')//设置页面进度条
		    	}else{
		    		layer.msg("上传失败");
		    	}
		    }
		  });
	    });
	
	
	</script>
</body>
</html>